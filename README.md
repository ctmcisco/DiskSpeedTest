# DiskSpeedTest

Utility to automate iterative IO performance tests.  
The tool includes two tests, one using the [DiskSpd](https://github.com/microsoft/diskspd) utility, and another iterating bulk file create, read, and delete operations.

I created the utility to help [troubleshoot](https://blog.insanegenius.com/2020/01/16/unraid-smb-performance-v6-7-2-vs-v6-8-1/) Unraid  SMB performance issues.

## License

[![GitHub](https://img.shields.io/github/license/ptr727/diskspeedtest)](./LICENSE)  
Licensed under the [MIT License](./LICENSE)

## Project

![GitHub last commit](https://img.shields.io/github/last-commit/ptr727/diskspeedtest?logo=github)  
Code is on [GitHub](https://github.com/ptr727/DiskSpeedtest).  
CI is on [Azure DevOps](https://dev.azure.com/pieterv/DiskSpeedTest).

## Build Status

[![Build Status](https://dev.azure.com/pieterv/DiskSpeedTest/_apis/build/status/DiskSpeedTest-Master-CI?branchName=master)](https://dev.azure.com/pieterv/DiskSpeedtest/_build/latest?definitionId=32&branchName=master)
![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/ptr727/diskspeedtest?logo=github&sort=semver)

## Getting Started

### Installation

- Install the [.NET Core 3.1 Runtime](https://dotnet.microsoft.com/download) and [download](https://github.com/ptr727/DiskSpeedTest/releases/latest) pre-compiled binaries.
- Or compile from [code](https://github.com/ptr727/DiskSpeedtest.git) using [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/) or [Visual Studio Code](https://code.visualstudio.com/download) or the [.NET Core 3.1 SDK](https://dotnet.microsoft.com/download).
- Download [DiskSpd](https://aka.ms/diskspd), and place the `diskspd.exe` binary in the path or the working directory.

### Configuration

```jsonc
{
  // Add a timestamp to the result output filenames
  "timestampresultfile": false,
  // DiskSpeedTest config
  "diskspeedtest": {
    // Enable this test
    "enabled": true,
    // Output CSV file
    "resultfile": "DiskSpeedResult.csv",
    // Test targets, full path and filename, directory must exist, file will be created
    "targets": [
      "C:\\Temp\\DiskSpeedData.dat",
      "\\\\Server\\Share\\DiskSpeedData.dat"
    ],
    // File size of test target in bytes
    "targetsize": 68719476736,
    // Block size in bytes, automatically generated by doubling the beginning value until the end size is reached
    "blocksizebegin": 4096,
    "blocksizeend": 2097152,
    // Warmup time in seconds, do IO but don't use the values in computed results
    "warmuptime": 30,
    // Test time in seconds
    "testtime": 120,
    // Time to rest between test runs
    "resttime": 0
  },
  // FileIterationTest config
  "fileiterationtest": {
    // Enable this test
    "enabled": true,
    // Output CSV file
    "resultfile": "FileIterationResult.csv",
    // Test targets, full path, directory will be created, contents will be deleted
    "targets": [
      "C:\\Temp\\FileIteration",
      "\\\\Server\\Share\\FileIteration"
    ],
    // Folder depth for recursion
    "folderdepth": 2,
    // Folders per folder
    "foldersperfolder": 2,
    // Files per folder
    "filesperfolder": 1000,
    // File size in bytes
    "filesize": 65536
  }
}
```

### Run Tests

`DiskSpeedtest.exe [Config File]`  
E.g. `DiskSpeedTest.exe DiskSpeedTest.json`.

## CSV Output Files

Import the CSV results in Excel and use pivot tables for analysis.

### DiskSpeedTest CSV Format

`UTC, Target, FileSize, BlockSize, WriteRatio, ThreadCount, OutstandingOperations, WarmupTime, TestTime, Bytes, IOS`

### FileIterationTest CSV Format

`UTC, Target, FileSize, FolderDepth, FoldersPerFolder, FilesPerFolder, FolderCount, FileCount, CreateTime, ReadTime, DeleteTime`

## Notes

- `DiskSpd` can be destructive, especially when running elevated, _**use at your own risk.**_
- `DiskSpd` will use privileged IO functions when running elevated. Test results will differ between running elevated or not, do not mix test results.
